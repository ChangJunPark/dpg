echo ubuntu soft core unlimited >> /etc/security/limits.conf
echo ubuntu hard core unlimited >> /etc/security/limits.conf
git clone https://github.com/rennu/dpg.git /opt/pipeline
cd /tmp
apt -y update && apt upgrade -y
apt -y install gdb ffmpeg mediainfo exiftool joe dstat htop unzip curl build-essential git libpng-dev libxxf86vm1 libxxf86vm-dev libxi-dev libxrandr-dev graphviz mercurial cmake libpng-dev libjpeg-dev libtiff-dev libglu1-mesa-dev libboost-iostreams-dev libboost-program-options-dev libboost-system-dev libboost-serialization-dev libopencv-dev libcgal-dev libcgal-qt5-dev libatlas-base-dev libsuitesparse-dev
mkdir /tmp/build
git clone -b develop --recursive https://github.com/openMVG/openMVG.git /tmp/build/openmvg
cd /tmp/build/openmvg
#git reset --hard 9b2b0c525e1a3716df56e539a1a47961abcc2931
mkdir /tmp/build/openmvg_build && cd /tmp/build/openmvg_build 
cmake -DCMAKE_BUILD_TYPE=RELEASE . /tmp/build/openmvg/src -DCMAKE_INSTALL_PREFIX=/opt/openmvg 
make -j2 && make install 
hg clone https://bitbucket.org/eigen/eigen#3.2 /tmp/build/eigen 
mkdir /tmp/build/eigen_build && cd /tmp/build/eigen_build 
cmake . ../eigen 
make -j2 && make install 
git clone https://github.com/cdcseacave/VCG.git /tmp/build/vcglib 
git clone https://ceres-solver.googlesource.com/ceres-solver /tmp/build/ceres_solver 
mkdir /tmp/build/ceres_build && cd /tmp/build/ceres_build 
cmake . ../ceres_solver/ -DMINIGLOG=ON -DBUILD_TESTING=OFF -DBUILD_EXAMPLES=OFF 
make -j2 && make install 
git clone https://github.com/cdcseacave/openMVS.git /tmp/build/openmvs 
cd /tmp/build/openmvs
#git reset --hard 5ed0d9e3c1ff5f73c945660676d1e2956803915b
mkdir /tmp/build/openmvs_build && cd /tmp/build/openmvs_build_debug
cmake . ../openmvs -DCMAKE_BUILD_TYPE=Debug -DVCG_DIR="/tmp/build/vcglib" -DCMAKE_INSTALL_PREFIX=/opt/openmvs 
make -j2 && make install 
git clone https://github.com/pmoulon/CMVS-PMVS /tmp/build/cmvs-pmvs
mkdir /tmp/build/cmvs-pmvs_build && cd /tmp/build/cmvs-pmvs_build
cmake ../cmvs-pmvs/program -DCMAKE_INSTALL_PREFIX=/opt/cmvs
make -j2 && make install
